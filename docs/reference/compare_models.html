<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Comparison of nested models — compare_models • chandwich</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comparison of nested models — compare_models"><meta name="description" content="Compares nested models using the adjusted likelihood ratio test statistic
(ALRTS) described in Section 3.5 of Chandler and Bate (2007). The nesting
must result from the simple constraint that a subset of the parameters of
the larger model is held fixed."><meta property="og:description" content="Compares nested models using the adjusted likelihood ratio test statistic
(ALRTS) described in Section 3.5 of Chandler and Bate (2007). The nesting
must result from the simple constraint that a subset of the parameters of
the larger model is held fixed."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">chandwich</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/chandwich-vignette.html">Introducing chandwich: Chandler-Bate Sandwich Loglikelihood Adjustment</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/paulnorthrop/chandwich/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Comparison of nested models</h1>
      <small class="dont-index">Source: <a href="https://github.com/paulnorthrop/chandwich/blob/HEAD/R/compare_models.R"><code>R/compare_models.R</code></a></small>
      <div class="d-none name"><code>compare_models.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compares nested models using the adjusted likelihood ratio test statistic
(ALRTS) described in Section 3.5 of Chandler and Bate (2007). The nesting
must result from the simple constraint that a subset of the parameters of
the larger model is held fixed.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">compare_models</span><span class="op">(</span></span>
<span>  <span class="va">larger</span>,</span>
<span>  smaller <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  approx <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vertical"</span>, <span class="st">"cholesky"</span>, <span class="st">"spectral"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  fixed_pars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fixed_at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep_len</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fixed_pars</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-larger">larger<a class="anchor" aria-label="anchor" href="#arg-larger"></a></dt>
<dd><p>An object of class <code>"chandwich"</code> returned by
<code><a href="adjust_loglik.html">adjust_loglik</a></code>.  The larger of the two models.</p></dd>


<dt id="arg-smaller">smaller<a class="anchor" aria-label="anchor" href="#arg-smaller"></a></dt>
<dd><p>An object of class <code>"chandwich"</code> returned by
  <code><a href="adjust_loglik.html">adjust_loglik</a></code>.  The smaller of the two models.</p>
<p>If <code>smaller</code> is supplied then the arguments <code>fixed_pars</code> and
  <code>fixed_at</code> described below are ignored.</p></dd>


<dt id="arg-approx">approx<a class="anchor" aria-label="anchor" href="#arg-approx"></a></dt>
<dd><p>A logical scalar.  If <code>approx = TRUE</code> then the
  approximation detailed by equations (18)-(20) of Chandler and Bate (2007)
  is used.  This option is available only if <code>smaller</code> is supplied.
  If <code>smaller</code> is not supplied then <code>approx = TRUE</code> is used,
  with no warning.</p>
<p>The approximation doesn't make sense if <code>type = "none"</code>.  If
  <code>type = "none"</code> and <code>approx = TRUE</code> then <code>approx</code> is
  set to <code>FALSE</code> with no warning.</p>
<p>If <code>approx = FALSE</code> then the adjusted likelihood is
  maximised under the restriction imposed by <code>delta</code>, that is,
  equation (17) of Chandler and Bate (2007) is used.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>A character scalar.  The argument <code>type</code> to the function
returned by <code><a href="adjust_loglik.html">adjust_loglik</a></code>, that is, the type of adjustment
made to the independence loglikelihood function.</p></dd>


<dt id="arg-fixed-pars">fixed_pars<a class="anchor" aria-label="anchor" href="#arg-fixed-pars"></a></dt>
<dd><p>A numeric vector.  Indices of the components of the
<strong>full</strong> parameter vector that are restricted to be equal to the
value(s) in <code>fixed_at</code>.</p></dd>


<dt id="arg-fixed-at">fixed_at<a class="anchor" aria-label="anchor" href="#arg-fixed-at"></a></dt>
<dd><p>A numeric vector of length 1 or <code>length(fixed_pars)</code>.
If <code>length(fixed_at) = 1</code> then the components <code>fixed_pars</code>
of the parameter vector are all fixed at <code>fixed_at</code>.
If <code>length(fixed_at) = length(fixed_pars)</code> then the component
<code>fixed_pars[i]</code> is fixed at <code>fixed_at[i]</code> for each <code>i</code>.</p></dd>


<dt id="arg-init">init<a class="anchor" aria-label="anchor" href="#arg-init"></a></dt>
<dd><p>(Only relevant if <code>approx = FALSE</code>).
A numeric vector of initial values for use in the search for
the MLE under the smaller model.  Must have length equal to the number
of parameters in the smaller of the two models being compared.  If
<code>init</code> is not supplied, or it is of the wrong length, then
<code>attr(smaller, "MLE")</code> is used if <code>smaller</code> is supplied and
<code>attr(larger, "MLE")[-fixed_pars]</code> otherwise.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments to be passed to <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code>.
These may include <code>gr</code>, <code>method</code>, <code>lower</code>, <code>upper</code>
or <code>control</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class "compmod", a list with components</p>
<dl><dt>alrts</dt>
<dd><p>the adjusted likelihood ratio test statistic.</p></dd>

 <dt>df</dt>
<dd><p>under the null hypothesis that the smaller model is a valid
   simplification of the larger model the adjusted likelihood ratio
   test statistic has a chi-squared distribution with <code>df</code>
   degrees of freedom.</p></dd>

 <dt>p_value</dt>
<dd><p>the p-value associated with the test of the null
   hypothesis.</p></dd>

 <dt>larger_mle</dt>
<dd><p>the MLE of the parameters under the larger model.</p></dd>

 <dt>smaller_mle</dt>
<dd><p>the MLE of the parameters under the smaller model.</p></dd>

 <dt>larger_fixed_pars, smaller_fixed_pars</dt>
<dd><p>Numeric vectors of the
   indices of parameters fixed in the larger and smaller models,
   respectively.</p></dd>

 <dt>larger_fixed_at, smaller_fixed_at</dt>
<dd><p>Numeric vectors of the
   values at which the parameters in <code>larger_fixed_pars</code> and
   <code>smaller_fixed_pars</code> are fixed.</p></dd>

 <dt>approx</dt>
<dd><p>the argument <code>approx</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The smaller of the two models is specified either by supplying
  <code>smaller</code> or <code>fixed_pars</code>.  If both are supplied then
  <code>smaller</code> takes precedence.</p>
<p>For full details see Section 3.5 of Chandler and Bate (2007).
  If <code>approx = FALSE</code> then the a likelihood ratio test of the null
  hypothesis that the smaller model is a valid simplification of the larger
  model is carried out directly using equation (17) of Chandler and Bate
  (2007) based on the adjusted loglikelihood under the larger model,
  returned by <code>adjust_loglik</code>.  This adjusted loglikelihood is
  maximised subject to the constraint that a subset of the parameters
  in the larger model are fixed.  If <code>smaller</code> is supplied
  then this maximisation can be avoided using an approximation
  detailed by equations (18)-(20) of Chandler and Bate (2007), which uses
  the MLE under the smaller model.  The same null distribution (chi-squared
  with degrees of freedom equal to the number of parameters that are fixed)
  is used in both cases.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Chandler, R. E. and Bate, S. (2007). Inference for clustered
  data using the independence loglikelihood. <em>Biometrika</em>,
  <strong>94</strong>(1), 167-183. <a href="https://doi.org/10.1093/biomet/asm015" class="external-link">doi:10.1093/biomet/asm015</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="adjust_loglik.html">adjust_loglik</a></code> to adjust a user-supplied
  loglikelihood function.</p>
<p><code><a href="conf_intervals.html">conf_intervals</a></code> for confidence intervals for
  individual parameters.</p>
<p><code><a href="conf_region.html">conf_region</a></code> for a confidence region for
  pairs of parameters.</p>
<p><code><a href="print.compmod.html">print.compmod</a></code>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># -------------------------- GEV model, owtemps data -----------------------</span></span></span>
<span class="r-in"><span><span class="co"># ------------ following Section 5.2 of Chandler and Bate (2007) -----------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">gev_loglik</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">o_pars</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="va">pars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">w_pars</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span> <span class="op">-</span> <span class="va">pars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="va">o_pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">w_pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">o_data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="st">"Oxford"</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">w_data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="st">"Worthing"</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">check</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">o_pars</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">o_data</span> <span class="op">-</span> <span class="va">o_pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">o_pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">check</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">check</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">w_pars</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">w_data</span> <span class="op">-</span> <span class="va">w_pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">w_pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">check</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">o_loglik</span> <span class="op">&lt;-</span> <span class="fu"><a href="log_gev.html">log_gev</a></span><span class="op">(</span><span class="va">o_data</span>, <span class="va">o_pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">o_pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">o_pars</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">w_loglik</span> <span class="op">&lt;-</span> <span class="fu"><a href="log_gev.html">log_gev</a></span><span class="op">(</span><span class="va">w_data</span>, <span class="va">w_pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">w_pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">w_pars</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">o_loglik</span> <span class="op">+</span> <span class="va">w_loglik</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initial estimates (method of moments for the Gumbel case)</span></span></span>
<span class="r-in"><span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">6</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">owtemps</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">pi</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">owtemps</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.57722</span> <span class="op">*</span> <span class="va">sigma</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Log-likelihood adjustment of the full model</span></span></span>
<span class="r-in"><span><span class="va">par_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu[0]"</span>, <span class="st">"mu[1]"</span>, <span class="st">"sigma[0]"</span>, <span class="st">"sigma[1]"</span>, <span class="st">"xi[0]"</span>, <span class="st">"xi[1]"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">large</span> <span class="op">&lt;-</span> <span class="fu"><a href="adjust_loglik.html">adjust_loglik</a></span><span class="op">(</span><span class="va">gev_loglik</span>, data <span class="op">=</span> <span class="va">owtemps</span>, init <span class="op">=</span> <span class="va">init</span>,</span></span>
<span class="r-in"><span>         par_names <span class="op">=</span> <span class="va">par_names</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Log-likelihood adjustment of some smaller models: xi[1] = 0 etc</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">medium</span> <span class="op">&lt;-</span> <span class="fu"><a href="adjust_loglik.html">adjust_loglik</a></span><span class="op">(</span>larger <span class="op">=</span> <span class="va">large</span>, fixed_pars <span class="op">=</span> <span class="st">"xi[1]"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">small</span> <span class="op">&lt;-</span> <span class="fu"><a href="adjust_loglik.html">adjust_loglik</a></span><span class="op">(</span>larger <span class="op">=</span> <span class="va">medium</span>, fixed_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma[1]"</span>, <span class="st">"xi[1]"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Tests</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Test xi1 = 0 (2 equivalent ways), vertical adjustment</span></span></span>
<span class="r-in"><span><span class="fu">compare_models</span><span class="op">(</span><span class="va">large</span>, fixed_pars <span class="op">=</span> <span class="st">"xi[1]"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model: gev_loglik </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> H0: "xi[1]" = 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HA: unrestricted model </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> test statistic = 6.356, df = 1, p-value = 0.0117</span>
<span class="r-in"><span><span class="fu">compare_models</span><span class="op">(</span><span class="va">large</span>, <span class="va">medium</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model: gev_loglik </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> H0: "xi[1]" = 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HA: unrestricted model </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> test statistic = 6.356, df = 1, p-value = 0.0117</span>
<span class="r-in"><span><span class="co"># Test xi1 = 0, using approximation</span></span></span>
<span class="r-in"><span><span class="fu">compare_models</span><span class="op">(</span><span class="va">large</span>, <span class="va">medium</span>, approx <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model: gev_loglik </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> H0: "xi[1]" = 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HA: unrestricted model </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Using using approximation (18) of Chandler and Bate (2007): </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> test statistic = 5.245, df = 1, p-value = 0.022</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Horizontal adjustments</span></span></span>
<span class="r-in"><span><span class="fu">compare_models</span><span class="op">(</span><span class="va">large</span>, <span class="va">medium</span>, type <span class="op">=</span> <span class="st">"cholesky"</span><span class="op">)</span><span class="op">$</span><span class="va">p_value</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.01593336</span>
<span class="r-in"><span><span class="fu">compare_models</span><span class="op">(</span><span class="va">large</span>, <span class="va">medium</span>, type <span class="op">=</span> <span class="st">"spectral"</span><span class="op">)</span><span class="op">$</span><span class="va">p_value</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.01229833</span>
<span class="r-in"><span><span class="co"># No adjustment (independence loglikelihood)</span></span></span>
<span class="r-in"><span><span class="fu">compare_models</span><span class="op">(</span><span class="va">large</span>, <span class="va">medium</span>, type <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">$</span><span class="va">p_value</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.074199</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Test sigma1 = 0 for model with xi1 = 0</span></span></span>
<span class="r-in"><span><span class="fu">compare_models</span><span class="op">(</span><span class="va">medium</span>, <span class="va">small</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model: gev_loglik </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> H0: ("sigma[1]", "xi[1]") = (0, 0) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HA: "xi[1]" = 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> test statistic = 4.251, df = 1, p-value = 0.03924</span>
<span class="r-in"><span><span class="co"># Test sigma1 = xi1 = 0</span></span></span>
<span class="r-in"><span><span class="fu">compare_models</span><span class="op">(</span><span class="va">large</span>, <span class="va">small</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model: gev_loglik </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> H0: ("sigma[1]", "xi[1]") = (0, 0) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HA: unrestricted model </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> test statistic = 8.6, df = 2, p-value = 0.01357</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># --------- Misspecified Poisson model for negative binomial data ----------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ... following Section 5.1 of the "Object-Oriented Computation of Sandwich</span></span></span>
<span class="r-in"><span><span class="co"># Estimators" vignette of the sandwich package</span></span></span>
<span class="r-in"><span><span class="co"># https://cran.r-project.org/web/packages/sandwich/vignettes/sandwich-OOP.pdf</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulate data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">250</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">rnbinom</a></span><span class="op">(</span><span class="fl">250</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">x</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Fit misspecified Poisson model</span></span></span>
<span class="r-in"><span><span class="va">fm_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, family <span class="op">=</span> <span class="va">poisson</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fm_pois</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Estimate Std. Error   z value      Pr(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  1.06326821 0.04135723 25.709367 9.184267e-146</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x            0.99607219 0.05353446 18.606186  2.862861e-77</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> I(x^2)      -0.04912373 0.02314608 -2.122335  3.380961e-02</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Contributions to the independence loglikelihood</span></span></span>
<span class="r-in"><span><span class="va">pois_glm_loglik</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">y</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">log_mu</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">pars</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span> <span class="op">^</span> <span class="fl">2</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">y</span>, lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_mu</span><span class="op">)</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"gamma"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pois_quad</span> <span class="op">&lt;-</span> <span class="fu"><a href="adjust_loglik.html">adjust_loglik</a></span><span class="op">(</span><span class="va">pois_glm_loglik</span>, y <span class="op">=</span> <span class="va">y</span>, x <span class="op">=</span> <span class="va">x</span>, par_names <span class="op">=</span> <span class="va">pars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pois_quad</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            MLE      SE adj. SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alpha  1.06300 0.04136 0.08378</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> beta   0.99610 0.05354 0.10520</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gamma -0.04913 0.02315 0.03628</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pois_lin</span> <span class="op">&lt;-</span> <span class="fu"><a href="adjust_loglik.html">adjust_loglik</a></span><span class="op">(</span>larger <span class="op">=</span> <span class="va">pois_quad</span>, fixed_pars <span class="op">=</span> <span class="st">"gamma"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Test the significance of the quadratic term</span></span></span>
<span class="r-in"><span><span class="fu">compare_models</span><span class="op">(</span><span class="va">pois_quad</span>, <span class="va">pois_lin</span><span class="op">)</span><span class="op">$</span><span class="va">p_value</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.1772841</span>
<span class="r-in"><span><span class="fu">compare_models</span><span class="op">(</span><span class="va">pois_quad</span>, <span class="va">pois_lin</span>, approx <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">p_value</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.1657919</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul J. Northrop, Richard E. Chandler.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

